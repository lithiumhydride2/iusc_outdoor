<launch>
    <!-- 默认参数 -->
    <arg name="n" default="1"/>
    <arg name="i" default="1"/>  
    <!-- 无人机描述文件 -->
    <arg name="sdf" default="$(find uavros_gazebo)/models/iris_usb_camera_down/iris_usb_camera_down.sdf"/>
    <arg name="fcu_param1" value="$(eval 14540 + arg('i'))"/>
    <arg name="fcu_param2" value="$(eval 14580 + arg('i'))"/>
    <arg name="fcu_url" value="udp://:$(arg fcu_param1)@localhost:$(arg fcu_param2)"/>
    
    <!-- 加载航点 -->
    <rosparam command="load" file="$(find iusc_land)/config/way_point.yaml"/>
    <!-- 加载无人机1 -->
    <group ns = "uav$(arg i)">
        <!-- px4 sitl and vehicle -->
        <include file="$(find uavros_gazebo)/launch/single_iris_usbcam_down.launch">
            <arg name="x" value="$(eval 2 * arg('i'))"/>
            <arg name="y" value="0"/>
            <arg name="z" value="0"/>
            <arg name="R" value="0"/>
            <arg name="P" value="0"/>
            <arg name="Y" value="1.570796"/>
            <arg name="sdf" value="$(arg sdf)"/>
            <arg name="ID" value="$(arg i)"/>
            <arg name="camNamespace" value="uav$(arg i)"/>
            <arg name="mavlink_udp_port" value="$(eval 14560 + arg('i'))"/>
            <arg name="mavlink_tcp_port" value="$(eval 4560 + arg('i'))"/>
        </include>
        <!-- 加载mavros -->
        <include file="$(find mavros)/launch/px4.launch">
            <arg name="fcu_url" value="$(arg fcu_url)"/>
            <arg name="gcs_url" value=""/>
            <arg name="tgt_system" value="$(eval 1 + arg('i'))"/>
            <arg name="tgt_component" value="1"/>
            <arg name="respawn_mavros" value="false"/>
        </include>

        <!-- 加载坐标变换 -->
        <node pkg="iusc_land" type="custom_tf.py" name="custom_tf" output="screen" args="$(arg i)"/>
        <!-- 加载策略控制器 -->
        <node pkg="iusc_land" type="land_strategy.py" name="land_strategy" output="screen" args="$(arg i)">
        </node>

        <node pkg="iusc_land" type="fake_promethus.py" name="fake_promethus" output="screen" args="$(arg i)"/>

    </group>

    <!-- 递归加载其他多无人机 -->
    <group if= "$(eval arg('i') != arg('n'))">
        <include file="$(find iusc_land)/launch/iusc_outdoor_uav.launch">
            <arg name="n" value="$(arg n)"/>
            <arg name="i" value="$(eval arg('i') + 1)"/>
        </include>
    </group>
</launch>
